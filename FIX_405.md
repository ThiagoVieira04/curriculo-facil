# ðŸ”§ CORREÃ‡ÃƒO DO ERRO 405 - GeraÃ§Ã£o de CurrÃ­culo

## Problema
Ao gerar currÃ­culo, retorna erro **405 (Method Not Allowed)**

## Causa Raiz
1. **vercel.json**: Rotas estÃ¡ticas (`/css`, `/js`, `/images`) estavam ANTES de `/api/*`
   - Vercel tentava servir como arquivo estÃ¡tico antes de rotear para o servidor
   
2. **Multer**: Sem tratamento de erro adequado
   - Erros silenciosos no processamento de FormData

## CorreÃ§Ãµes Aplicadas

### 1. ReordenaÃ§Ã£o de Rotas em vercel.json
```json
// ANTES (ERRADO):
"routes": [
  { "src": "/css/(.*)", "dest": "/public/css/$1" },
  { "src": "/js/(.*)", "dest": "/public/js/$1" },
  { "src": "/api/(.*)", "dest": "/server.js" }  // âŒ Nunca alcanÃ§ado
]

// DEPOIS (CORRETO):
"routes": [
  { "src": "/api/(.*)", "dest": "/server.js" },  // âœ… Primeiro
  { "src": "/css/(.*)", "dest": "/public/css/$1" },
  { "src": "/js/(.*)", "dest": "/public/js/$1" }
]
```

### 2. Tratamento de Erro do Multer em server.js
```javascript
// ANTES (ERRADO):
app.post('/api/generate-cv', upload.single('photo'), async (req, res) => {
  // Erros do multer nÃ£o eram capturados
})

// DEPOIS (CORRETO):
app.post('/api/generate-cv', (req, res, next) => {
    upload.single('photo')(req, res, (err) => {
        if (err instanceof multer.MulterError) {
            console.error('Multer error:', err);
            return res.status(400).json({ error: 'Erro no upload' });
        }
        next();
    });
}, async (req, res) => {
  // Agora captura erros do multer
})
```

### 3. Melhorias no Multer
- Adicionado `fileFilter` para aceitar qualquer arquivo
- ValidaÃ§Ã£o acontece DEPOIS do upload
- Erros sÃ£o capturados e retornados ao cliente

## Arquivos Modificados
- âœ… `vercel.json` - ReordenaÃ§Ã£o de rotas
- âœ… `server.js` - Tratamento de erro do multer

## Como Testar

### Localmente
```bash
npm run dev
node test-405.js
```

Resultado esperado:
```
Status: 200
âœ… SUCESSO! CurrÃ­culo gerado
```

### Em ProduÃ§Ã£o
1. Fazer push para main
2. Vercel farÃ¡ deploy automÃ¡tico
3. Testar em https://seu-dominio.vercel.app

## VerificaÃ§Ã£o
- âœ… POST /api/generate-cv retorna 200
- âœ… CurrÃ­culo gerado com sucesso
- âœ… Sem foto funciona
- âœ… Com foto funciona
- âœ… Erro 405 resolvido

## Status
âœ… **CORRIGIDO**
